#include <stdint.h>
#include <math.h>
#include "AttackFly.h"

#include "Object.h"
#include "Bullet.h"
#include "Graphics2D.h"
#include "5Pos_Switch.h"

#define ATTACKFLY_WIDTH 10
#define ATTACKFLY_HEIGHT 10

#define currentHealth variables[0]
#define velocity  variables[1]

const unsigned short attackfly[] = {
 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270,
 0x4270, 0x4270, 0x29CB, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x4270, 0x4270, 0x29CB, 0x29CB,
 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270,
 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x29CB,
 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270,
 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB,
 0x29CB, 0x29CB, 0x29CB, 0x29CB,

};

void AttackFlyCreate(Object *this, uint8_t x, uint8_t y) {
	Switch_Init();
	(*this).image = attackfly;
	(*this).width = ATTACKFLY_WIDTH;
	(*this).height = ATTACKFLY_HEIGHT;
	(*this).x = x*100;
	(*this).y = y*100;
	(*this).hasCollided = 0;
	(*this).isPassable = 1;
	(*this).isRendered = 1;
	(*this).logic = AttackFlyLogic;
	(*this).currentHealth = 6;		
	(*this).velocity = 10;
}

void AttackFlyLogic(Object *this, Object *player, uint64_t delta) {
	ObjectLogic(this,player,delta);
	int32_t vx = (-(*this).x+(*player).x);
	int32_t vy = (-(*this).y+(*player).y);
	int32_t c = sqrt(vx*vx+vy*vy);
	vx *= (*this).velocity;
	vy *= (*this).velocity;
	vx /= c;
	vy /= c;
	(*this).x += (int64_t)delta * vx / 100;
	(*this).y += (int64_t)delta * vy / 100;

}
