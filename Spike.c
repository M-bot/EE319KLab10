#include <stdint.h>
#include "Spike.h"

#include "Object.h"
#include "Player.h"
#include "Graphics2D.h"
#include "5Pos_Switch.h"

#define SPIKE_WIDTH 10
#define SPIKE_HEIGHT 10

#define damage variables[0]

const unsigned short spike[] = {
 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270,
 0x4270, 0x4270, 0x29CB, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x4270, 0x4270, 0x29CB, 0x29CB,
 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x4270,
 0x4270, 0x4270, 0x29CB, 0x29CB, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x29CB,
 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270, 0x4270,
 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB, 0x29CB,
 0x29CB, 0x29CB, 0x29CB, 0x29CB,

};

void SpikeCreate(Object *this, uint8_t x, uint8_t y, uint8_t dmg) {
	Switch_Init();
	(*this).image = spike;
	(*this).width = SPIKE_WIDTH;
	(*this).height = SPIKE_HEIGHT;
	(*this).x = x*100;
	(*this).y = y*100;
	(*this).hasCollided = 0;
	(*this).isPassable = 0;
	(*this).isRendered = 1;
	(*this).logic = SpikeLogic;
	(*this).damage = dmg;
}

uint16_t scooldown;
void SpikeLogic(Object *this, Object *player, uint64_t delta) {
	ObjectLogic(this,player,delta);
	if((*this).hasCollided) {
		if((*(*this).collidedWith).logic == PlayerLogic && scooldown == 0) {
			scooldown = 50;
			(*player).variables[1] -= (*this).damage;
			if((*player).variables[1] < 0) (*player).variables[1] = 0;
			(*player).variables[7] = 1;
		}
		if(scooldown != 0) {
			scooldown--;
		}
	}
}
